# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫—É–∫–∏ –Ω–∞ —Å–∞–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω–∞ —Å—É–º–æ–∫

## üìã –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å–∏—Å—Ç–µ–º—ã –∫—É–∫–∏ –Ω–∞ —Å–∞–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω–∞ —Å—É–º–æ–∫ –∏–∑ –±—É—Å–∏–Ω. –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ, –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏ —Å–µ—Å—Å–∏–æ–Ω–Ω—ã–µ –∫—É–∫–∏ —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞.

## üç™ –¢–∏–ø—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫—É–∫–∏

### 1. –°–µ—Å—Å–∏–æ–Ω–Ω—ã–µ –∫—É–∫–∏ (Session Cookies)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: –î–æ –∑–∞–∫—Ä—ã—Ç–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ 30 –¥–Ω–µ–π
- **–ü—Ä–∏–º–µ—Ä—ã**: 
  - `sessionid` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–∏ Django
  - `csrftoken` - —Ç–æ–∫–µ–Ω CSRF –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  - `cart` - –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã

### 2. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫—É–∫–∏ (Functional Cookies)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: 1 –≥–æ–¥
- **–ü—Ä–∏–º–µ—Ä—ã**:
  - `user_pref_theme` - —Ç–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
  - `user_pref_font_size` - —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
  - `remember_me` - "–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è"

### 3. –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫—É–∫–∏ (Analytics Cookies)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ—Å–µ—â–µ–Ω–∏–π
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: 30 –¥–Ω–µ–π - 1 –≥–æ–¥
- **–ü—Ä–∏–º–µ—Ä—ã**:
  - `analytics_first_visit` - –ø–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç
  - `analytics_last_visit` - –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–∑–∏—Ç
  - `analytics_visit_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ settings.py

```python
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã
CART_SESSION_ID = 'cart'

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Å—Å–∏–π
SESSION_COOKIE_AGE = 60 * 60 * 24 * 30  # 30 –¥–Ω–µ–π
SESSION_COOKIE_SECURE = False  # True –¥–ª—è HTTPS
SESSION_COOKIE_HTTPONLY = True
SESSION_COOKIE_SAMESITE = 'Lax'
SESSION_EXPIRE_AT_BROWSER_CLOSE = False

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ CSRF
CSRF_COOKIE_AGE = 60 * 60 * 24 * 30  # 30 –¥–Ω–µ–π
CSRF_COOKIE_SECURE = False  # True –¥–ª—è HTTPS
CSRF_COOKIE_HTTPONLY = True
CSRF_COOKIE_SAMESITE = 'Lax'
```

### Middleware –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

```python
class AnalyticsMiddleware:
    """
    Middleware –¥–ª—è —Å–±–æ—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –∫—É–∫–∏
    """
    
    def set_analytics_cookies(self, request, response):
        # –ö—É–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏—è
        if 'first_visit' not in request.COOKIES:
            response.set_cookie(
                'first_visit',
                timezone.now().isoformat(),
                max_age=60*60*24*365,  # 1 –≥–æ–¥
                httponly=False,
                samesite='Lax'
            )
        
        # –ö—É–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏—è
        response.set_cookie(
            'last_visit',
            timezone.now().isoformat(),
            max_age=60*60*24*30,  # 30 –¥–Ω–µ–π
            httponly=False,
            samesite='Lax'
        )
        
        # –ö—É–∫–∏ –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π
        visit_count = int(request.COOKIES.get('visit_count', 0)) + 1
        response.set_cookie(
            'visit_count',
            visit_count,
            max_age=60*60*24*365,  # 1 –≥–æ–¥
            httponly=False,
            samesite='Lax'
        )
```
